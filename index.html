
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>BigCat的个人博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="BigCat">
    

    
    <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="BigCat的个人博客">
<meta property="og:url" content="http://kkop233.github.io/index.html">
<meta property="og:site_name" content="BigCat的个人博客">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="BigCat的个人博客">
<meta name="twitter:description">

    
    <link rel="alternative" href="/atom.xml" title="BigCat的个人博客" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="BigCat的个人博客" title="BigCat的个人博客"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="BigCat的个人博客">BigCat的个人博客</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
						<li><a href="/categories">Categories</a></li>
					
						<li><a href="/tags">Tags</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:kkop233.github.io">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/solr/ciglxh0wt000axcnwbs7riiyv.html" title="Solr学习第04章：查询" itemprop="url">Solr学习第04章：查询</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="BigCat" target="_blank" itemprop="author">BigCat</a>
		
  <p class="article-time">
    <time datetime="2015-11-05T07:27:53.000Z" itemprop="datePublished"> 发表于 2015-11-05</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>本章讲的是进行搜索时使用的语法，由于solr是基于lucene的搜索引擎，所以语法与lucene大同小异。内容大部分翻译自Solr Wiki，地址：<a href="http://wiki.apache.org/solr/SolrQuerySyntax" target="_blank" rel="external">http://wiki.apache.org/solr/SolrQuerySyntax</a></p>
<h1 id="Lucene语法（注意和Solr有区别）">Lucene语法（注意和Solr有区别）</h1><h2 id="一、Terms_（条件）">一、Terms （条件）</h2><ul>
<li>Single Term就是一个单词，例如”hello”</li>
<li>多个单词由双引号包括组成了Phrase（短语），例如”hello world”</li>
</ul>
<h2 id="二、Field（字段）">二、Field（字段）</h2><p>基本用法为，字段：条件。例如 <code>name:&quot;Li Ming&quot;</code></p>
<ul>
<li>default字段不必指出，例如<code>&quot;hello world&quot;</code>即会自动搜索默认字段</li>
<li>条件为一个Phrase时，必须用双引号表示</li>
<li>查询多个字段时，可以用boolean符号连接，主义必须大写，例如<code>title:&quot;The Right Way&quot; AND text:go</code></li>
</ul>
<h2 id="三、Wildcard_Searches（通配符）">三、Wildcard Searches（通配符）</h2><p>在Single Term中可以使用通配符</p>
<ul>
<li>?代表一个字符</li>
<li>*代表多个字符</li>
<li>通配符不能位于开头</li>
</ul>
<h2 id="四、Regular_Expression_Searches（正则表达式）">四、Regular Expression Searches（正则表达式）</h2><p>用两个斜杠包括正则表达式以搜索，例如<code>/[mb]oat/</code>匹配moat和boat</p>
<h2 id="五、Fuzzy_Searches（模糊搜索）">五、Fuzzy Searches（模糊搜索）</h2><p>支持Damerau-Levenshtein distance算法下的模糊搜索，用法是关键词后追加一个波浪线，例如<code>room~1</code>，这个对于中文的模糊搜索没有什么卵用，中文模糊全文搜索还是用分词方法实现比较好</p>
<h2 id="六、Proximity_Searches（临近搜索）">六、Proximity Searches（临近搜索）</h2><p>用于当条件是一个短语的时候，例如<code>&quot;jakarta apache&quot;~10</code>，表示搜索含有这两个单词的文档，且之间的距离在10以内</p>
<h2 id="七、Range_Searches（范围搜索）">七、Range Searches（范围搜索）</h2><p>语法为<code>[最小值 TO 最大值]</code>，用星号表示无限。例如<code>number:[1 TO 10]</code>，此外也支持日期和字符串的范围搜索，例如<code>mod_date:[20020101 TO 20030101] title:{Aida TO Carmen}</code></p>
<h2 id="八、Boosting_a_Term（增加条件权重）">八、Boosting a Term（增加条件权重）</h2><p> <code>jakarta^4 apache</code>，用^增加了jakarta的权重，搜索偏重出现jakarta的结果。</p>
<h2 id="九、Boolean_Operators（布尔运算符）">九、Boolean Operators（布尔运算符）</h2><p>有五个，分别是OR AND NOT + -</p>
<h3 id="OR">OR</h3><blockquote>
<p>The OR operator links two terms and finds a matching document if either of the terms exist in a document.</p>
</blockquote>
<p>OR运算符连接的条件中有至少一个会被结果匹配。<br><code>OR</code>运算符是默认的运算符，以空格隔开的“表达式“默认之间是“或者”的关系，可以用<code>||</code>代替之。</p>
<h3 id="AND">AND</h3><blockquote>
<p>The AND operator matches documents where both terms exist anywhere in the text of a single document. </p>
</blockquote>
<p>AND运算符连接的条件都必须被结果匹配。<br><code>AND</code>可以被<code>&amp;&amp;</code>代替</p>
<h3 id="NOT">NOT</h3><blockquote>
<p>The NOT operator excludes documents that contain the term after NOT. </p>
</blockquote>
<p>含有NOT后面的条件的结果不会被搜索到。<br>注意，NOT是双目运算符，意义应该是“含有前者但不包含后者的意思”，例如<code>&quot;jakarta apache&quot; NOT &quot;Apache Lucene&quot;</code>表示含有jakarta apache而不包括Apache Lucene，可以被写为<code>!</code></p>
<h3 id="+">+</h3><blockquote>
<p>The “+” or required operator requires that the term after the “+” symbol exist somewhere in a the field of a single document.</p>
</blockquote>
<p>结果中的任意字段包含+后面的条件。</p>
<h3 id="-">-</h3><blockquote>
<p>The “-“ or prohibit operator excludes documents that contain the term after the “-“ symbol.</p>
</blockquote>
<p>结果中的任意字段都不包含+后面的条件。<br>减号的作用与NOT相同。</p>
<h2 id="Grouping_and_Field_Grouping_（分组）">Grouping and Field Grouping （分组）</h2><p>不同条件可以用小括号分组，例如<code>(jakarta OR apache) AND website</code><br>同一个字段的不同条件可以在字段后加小括号，例如<code>title:(+return +&quot;pink panther&quot;)</code></p>
<h2 id="Escaping_Special_Characters（特殊字符转义）">Escaping Special Characters（特殊字符转义）</h2><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+ - &amp;&amp; <span class="string">|| ! ( ) &#123; &#125; [ ] ^ "</span> ~ * ? : \ /</span><br></pre></td></tr></table></figure>
<p>遇到这些字符时，可以用<code>\</code>来转义，例如<code>\(1\+1\)\:2</code></p>
<h1 id="Solr与Lucene的不同">Solr与Lucene的不同</h1><ul>
<li><blockquote>
<p>Range queries [a TO z], prefix queries a<em>, and wildcard queries a</em>b are constant-scoring (all matching documents get an equal score). The scoring factors tf, idf, index boost, and coord are not used. There is no limitation on the number of terms that match (as there was in past versions of Lucene).</p>
</blockquote>
</li>
</ul>
<p>范围搜索、通配符如<code>a*</code>、<code>a*b</code>的搜索，结果的score是一样的，tf idf index boost coord不用。</p>
<ul>
<li><blockquote>
<p>A * may be used for either or both endpoints to specify an open-ended range query.</p>
</blockquote>
</li>
</ul>
<p>范围搜索两端都可以用星号。</p>
<ul>
<li><blockquote>
<p>Pure negative queries (all clauses prohibited) are allowed.</p>
</blockquote>
</li>
</ul>
<p>减号/not 可以单独使用。</p>
<ul>
<li><blockquote>
<p>A hook into FunctionQuery syntax. Quotes will be necessary to encapsulate the function when it includes parentheses.<br>Example: <em>val</em>:”recip(rord(myfield),1,2,3)”<br>Nested query support for any type of query parser (via QParserPlugin). Quotes will often be necessary to encapsulate the nested query if it contains reserved characters.<br>Example: <em>query</em>:”{!dismax qf=myfield}how now brown cow”</p>
</blockquote>
</li>
<li><p>如果使用DateField类型，必须严格遵照yyyy-MM-ddTHH-mm-ss.sssZ</p>
</li>
</ul>
<h1 id="查询字段含义">查询字段含义</h1><ul>
<li><code>q</code> 查询语句，唯一，必填</li>
<li><code>fq</code> 过滤查询，可以有多个，非必须</li>
<li><code>sort</code> 排序字段，如name desc，注意<code>score</code>是个关键词，指的是搜索结果的匹配度评分，schame里面的字段名不要叫score，否则无法排序</li>
<li><code>start,rows</code> 分页字段，start是从结果的第几条开始，rows是一共返回多少条，注意start从0开始，类似于c语言风格的数组下标</li>
<li><code>fl</code> 逗号分隔的字段名字符串，规定本次搜索返回的结果中包含什么字段</li>
<li><code>df</code> 规定默认查询字段</li>
<li><code>wt</code> 规定返回格式，xml, json, php, phps</li>
<li>lbs、facet搜索时候用的一些特殊字段后文再讲</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/solr/">solr</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/solr/">solr</a><a href="/tags/搜索/">搜索</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/solr/ciglxh0wx000excnwtsuabzli.html" title="Solr学习第03章：快速上手-客户端" itemprop="url">Solr学习第03章：快速上手-客户端</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="BigCat" target="_blank" itemprop="author">BigCat</a>
		
  <p class="article-time">
    <time datetime="2015-10-29T03:23:30.000Z" itemprop="datePublished"> 发表于 2015-10-29</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="SolrJ使用">SolrJ使用</h1><p>上一章我们配置了索引，导入了数据，并且实现了再solr的管理页面搜索数据。但是我们现在面临一个问题，虽然可以用http的方式与solr交互了，但非常的不方便。请求必须自己拼凑字符串，response也必须自己手动处理长长的json字符串，成功失败的状态也必须自己解析等等。<br>好在Solr的开发者已经帮助我们开发好了各种语言使用的客户端，这个客户端可以类比为连接MySQL的JDBC。<br>我们先建立个简单的Java项目，拷贝<code>solr-5.3.1\dist</code>目录下的<code>solr-solrj-5.3.1.jar</code>，以及<code>solr-5.3.1\dist\solrj-lib</code>下的所有jar引入工程，可能还缺少一个commons-logging.jar，百度下载即可。<br>jar包导入后编写代码：<br>Student.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> solrj;</span><br><span class="line"><span class="comment">//省略import</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="annotation">@Field</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="annotation">@Field</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="annotation">@Field</span></span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    <span class="annotation">@Field</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> avg_score;</span><br><span class="line">    <span class="annotation">@Field</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; hobby;</span><br><span class="line">    <span class="annotation">@Field</span></span><br><span class="line">    <span class="keyword">private</span> String motto;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(<span class="keyword">int</span> id, String name, Date birthday, <span class="keyword">double</span> avg_score,</span><br><span class="line">            List&lt;String&gt; hobby)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.birthday = birthday;</span><br><span class="line">        <span class="keyword">this</span>.avg_score = avg_score;</span><br><span class="line">        <span class="keyword">this</span>.hobby = hobby;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Student [id="</span> + id + <span class="string">", name="</span> + name + <span class="string">", birthday="</span></span><br><span class="line">                + birthday + <span class="string">", avg_score="</span> + avg_score + <span class="string">", hobby="</span> + hobby</span><br><span class="line">                + <span class="string">", motto="</span> + motto + <span class="string">"]"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">      <span class="comment">// 省略get set方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>注意Student中的field必须用@Field注解<br>Main.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> solrj;</span><br><span class="line"><span class="comment">//省略import</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> String url=<span class="string">"http://host:port/solr/student"</span>;   <span class="comment">//注意改成你的地址</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span> <span class="keyword">throws</span> SolrServerException, IOException </span>&#123;</span><br><span class="line">        List&lt;String&gt; list=<span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        list.add(<span class="string">"暴走"</span>);</span><br><span class="line">        list.add(<span class="string">"漫画"</span>);</span><br><span class="line">        list.add(<span class="string">"篮球"</span>);</span><br><span class="line">        SolrInputDocument doc=<span class="keyword">new</span> SolrInputDocument();</span><br><span class="line">        doc.setField(<span class="string">"id"</span>, <span class="number">666</span>);</span><br><span class="line">        doc.setField(<span class="string">"name"</span>, <span class="string">"王尼玛"</span>);</span><br><span class="line">        doc.setField(<span class="string">"birthday"</span>, <span class="keyword">new</span> Date());</span><br><span class="line">        doc.setField(<span class="string">"avg_score"</span>, <span class="number">9.9</span>);</span><br><span class="line">        doc.setField(<span class="string">"hobby"</span>, list); <span class="comment">// list可以是继承Collection的对象</span></span><br><span class="line">        doc.setField(<span class="string">"motto"</span>, <span class="string">"fxxk my life"</span>);</span><br><span class="line">        </span><br><span class="line">        SolrClient server = <span class="keyword">new</span>    HttpSolrClient(url);</span><br><span class="line">        UpdateResponse response=server.add(doc);</span><br><span class="line">        server.commit();</span><br><span class="line">        server.close();</span><br><span class="line">        System.out.println(response.toString());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">search</span><span class="params">()</span> <span class="keyword">throws</span> SolrServerException, IOException </span>&#123;</span><br><span class="line">        SolrClient server = <span class="keyword">new</span>    HttpSolrClient(url);</span><br><span class="line">        SolrQuery query=<span class="keyword">new</span> SolrQuery();</span><br><span class="line">        query.set(<span class="string">"q"</span>, <span class="string">"hobby:篮球 AND id:[2 TO *]"</span>);</span><br><span class="line">        QueryResponse response=server.query(query);</span><br><span class="line">        List&lt;Student&gt; list=response.getBeans(Student.class);</span><br><span class="line">        server.close();</span><br><span class="line">        <span class="keyword">for</span> (Student student : list) &#123;</span><br><span class="line">            System.out.println(student.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> SolrServerException, IOException </span>&#123;</span><br><span class="line">        add();</span><br><span class="line">        search();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>注意事项：</p>
<ul>
<li>add是用solrj工具添加了一条记录，search是搜索hobby含有篮球并且id大于2的对象</li>
<li>SolrClient 对象在使用完后需要关闭，在实际使用中，一个SolrClient对象可以被多线程复用</li>
<li>Java bean里面需要存储的字段注意使用注解标注</li>
</ul>
<p>运行结果：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;responseHeader=&#123;status=<span class="number">0</span>,QTime=<span class="number">58</span>&#125;&#125;</span><br><span class="line">Student [id=<span class="number">3</span>, name=李明, birthday=Tue Jan <span class="number">01</span> <span class="number">08</span>:<span class="number">00</span>:<span class="number">00</span> CST <span class="number">1991</span>, avg_score=<span class="number">111.0</span>, hobby=[篮球, 看电影, 夜跑], motto=null]</span><br><span class="line">Student [id=<span class="number">666</span>, name=王尼玛, birthday=Thu Oct <span class="number">29</span> <span class="number">11</span>:<span class="number">32</span>:<span class="number">22</span> CST <span class="number">2015</span>, avg_score=<span class="number">9.9</span>, hobby=[暴走, 漫画, 篮球], motto=fxxk my life]</span><br></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/solr/">solr</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/solr/">solr</a><a href="/tags/搜索/">搜索</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/solr/ciglxh0wz000ixcnwh1qyc19i.html" title="Solr学习第02章：快速上手-创建索引" itemprop="url">Solr学习第02章：快速上手-创建索引</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="BigCat" target="_blank" itemprop="author">BigCat</a>
		
  <p class="article-time">
    <time datetime="2015-10-29T03:23:16.000Z" itemprop="datePublished"> 发表于 2015-10-29</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>快速上手旨在最快速的建立一个可用的Demo工程，对solr的整个使用过程做一个概况的了解，忽略详细难以理解的超多配置，对进一步的学习起到构建大致框架的作用。</p>
<h1 id="一、Core的建立">一、Core的建立</h1><p>在Solr中，一个core就可以简单的类比为关系数据库中的表，一个core可以对应web开发中的java bean，例如，我们可以建立一个“学生”core：</p>
<h2 id="1-_手动建立core目录和配置文件">1. 手动建立core目录和配置文件</h2><p>打开{solrhome}，以<code>student</code> core 为例</p>
<pre><code>+ 建立<span class="escape">`s</span>tudent/conf<span class="escape">`文</span>件夹
+ 在<span class="escape">`c</span>onf<span class="escape">`下</span>创建<span class="escape">`s</span>chema.xml<span class="escape">`和</span><span class="escape">`s</span>olrconfig.xml<span class="escape">`文</span>件
</code></pre><p>这两个文件的sample在你下载的solr程序的<code>example</code>文件夹下有，带很多注释，我们编辑后的两个文件为：<br>schema.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">schema</span> <span class="attribute">name</span>=<span class="value">"student"</span> <span class="attribute">version</span>=<span class="value">"1.5"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">field</span> <span class="attribute">name</span>=<span class="value">"id"</span> <span class="attribute">type</span>=<span class="value">"int"</span> <span class="attribute">indexed</span>=<span class="value">"true"</span> <span class="attribute">stored</span>=<span class="value">"true"</span> <span class="attribute">required</span>=<span class="value">"true"</span> <span class="attribute">multiValued</span>=<span class="value">"false"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">field</span> <span class="attribute">name</span>=<span class="value">"name"</span> <span class="attribute">type</span>=<span class="value">"string"</span> <span class="attribute">indexed</span>=<span class="value">"true"</span> <span class="attribute">stored</span>=<span class="value">"true"</span> <span class="attribute">required</span>=<span class="value">"true"</span> <span class="attribute">multiValued</span>=<span class="value">"false"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">field</span> <span class="attribute">name</span>=<span class="value">"birthday"</span> <span class="attribute">type</span>=<span class="value">"date"</span> <span class="attribute">indexed</span>=<span class="value">"true"</span> <span class="attribute">stored</span>=<span class="value">"true"</span> <span class="attribute">required</span>=<span class="value">"true"</span> <span class="attribute">multiValued</span>=<span class="value">"false"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">field</span> <span class="attribute">name</span>=<span class="value">"avg_score"</span> <span class="attribute">type</span>=<span class="value">"double"</span> <span class="attribute">indexed</span>=<span class="value">"true"</span> <span class="attribute">stored</span>=<span class="value">"true"</span> <span class="attribute">required</span>=<span class="value">"true"</span> <span class="attribute">multiValued</span>=<span class="value">"false"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">field</span> <span class="attribute">name</span>=<span class="value">"hobby"</span> <span class="attribute">type</span>=<span class="value">"string"</span> <span class="attribute">indexed</span>=<span class="value">"true"</span> <span class="attribute">stored</span>=<span class="value">"true"</span> <span class="attribute">required</span>=<span class="value">"true"</span> <span class="attribute">multiValued</span>=<span class="value">"true"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">field</span> <span class="attribute">name</span>=<span class="value">"motto"</span> <span class="attribute">type</span>=<span class="value">"string"</span> <span class="attribute">indexed</span>=<span class="value">"false"</span> <span class="attribute">stored</span>=<span class="value">"true"</span> <span class="attribute">required</span>=<span class="value">"false"</span> <span class="attribute">multiValued</span>=<span class="value">"false"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">uniqueKey</span>&gt;</span>id<span class="tag">&lt;/<span class="title">uniqueKey</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">field</span> <span class="attribute">name</span>=<span class="value">"_version_"</span> <span class="attribute">type</span>=<span class="value">"long"</span>     <span class="attribute">indexed</span>=<span class="value">"true"</span>  <span class="attribute">stored</span>=<span class="value">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">fieldtype</span> <span class="attribute">name</span>=<span class="value">"string"</span>  <span class="attribute">class</span>=<span class="value">"solr.StrField"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">fieldType</span> <span class="attribute">name</span>=<span class="value">"int"</span> <span class="attribute">class</span>=<span class="value">"solr.TrieIntField"</span> <span class="attribute">precisionStep</span>=<span class="value">"0"</span> <span class="attribute">positionIncrementGap</span>=<span class="value">"0"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">fieldType</span> <span class="attribute">name</span>=<span class="value">"double"</span> <span class="attribute">class</span>=<span class="value">"solr.TrieDoubleField"</span> <span class="attribute">precisionStep</span>=<span class="value">"0"</span> <span class="attribute">positionIncrementGap</span>=<span class="value">"0"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">fieldType</span> <span class="attribute">name</span>=<span class="value">"date"</span> <span class="attribute">class</span>=<span class="value">"solr.TrieDateField"</span> <span class="attribute">precisionStep</span>=<span class="value">"0"</span> <span class="attribute">positionIncrementGap</span>=<span class="value">"0"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">fieldType</span> <span class="attribute">name</span>=<span class="value">"long"</span> <span class="attribute">class</span>=<span class="value">"solr.TrieLongField"</span> <span class="attribute">precisionStep</span>=<span class="value">"0"</span> <span class="attribute">positionIncrementGap</span>=<span class="value">"0"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">schema</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>一个学生我们定义了6个字段，其中值得注意的是：</p>
<pre><code>+ 有个主键“<span class="property">id</span>”，没什么特殊需求的话这个字段必须有，用uniqueKey来指出，也可以是<span class="type">string</span>
+ hobby（爱好）multiValued=<span class="constant">true</span>，这个字段可以有多个值
+ motto（座右铭）indexed=<span class="constant">false</span>，这个字段不能被用于检索和排序
</code></pre><p>solrconfig.xml 这个文件很长，但是刚开始不用每一项都搞清楚，直接使用默认配置就可以<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">config</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">luceneMatchVersion</span>&gt;</span>5.2.0<span class="tag">&lt;/<span class="title">luceneMatchVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">dataDir</span>&gt;</span>$&#123;solr.data.dir:&#125;<span class="tag">&lt;/<span class="title">dataDir</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">directoryFactory</span> <span class="attribute">name</span>=<span class="value">"DirectoryFactory"</span> </span><br><span class="line">                    <span class="attribute">class</span>=<span class="value">"$&#123;solr.directoryFactory:solr.NRTCachingDirectoryFactory&#125;"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">directoryFactory</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="title">codecFactory</span> <span class="attribute">class</span>=<span class="value">"solr.SchemaCodecFactory"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">schemaFactory</span> <span class="attribute">class</span>=<span class="value">"ClassicIndexSchemaFactory"</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">indexConfig</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">lockType</span>&gt;</span>$&#123;solr.lock.type:native&#125;<span class="tag">&lt;/<span class="title">lockType</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">infoStream</span>&gt;</span>true<span class="tag">&lt;/<span class="title">infoStream</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">indexConfig</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">updateHandler</span> <span class="attribute">class</span>=<span class="value">"solr.DirectUpdateHandler2"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">updateLog</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">str</span> <span class="attribute">name</span>=<span class="value">"dir"</span>&gt;</span>$&#123;solr.ulog.dir:&#125;<span class="tag">&lt;/<span class="title">str</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">updateLog</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">autoCommit</span>&gt;</span> </span><br><span class="line">       <span class="tag">&lt;<span class="title">maxTime</span>&gt;</span>$&#123;solr.autoCommit.maxTime:1500&#125;<span class="tag">&lt;/<span class="title">maxTime</span>&gt;</span> </span><br><span class="line">       <span class="tag">&lt;<span class="title">openSearcher</span>&gt;</span>true<span class="tag">&lt;/<span class="title">openSearcher</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="title">autoCommit</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">updateHandler</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">query</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">maxBooleanClauses</span>&gt;</span>1024<span class="tag">&lt;/<span class="title">maxBooleanClauses</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">query</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">requestHandler</span> <span class="attribute">name</span>=<span class="value">"/select"</span> <span class="attribute">class</span>=<span class="value">"solr.SearchHandler"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">lst</span> <span class="attribute">name</span>=<span class="value">"defaults"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="title">str</span> <span class="attribute">name</span>=<span class="value">"echoParams"</span>&gt;</span>explicit<span class="tag">&lt;/<span class="title">str</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="title">int</span> <span class="attribute">name</span>=<span class="value">"rows"</span>&gt;</span>10<span class="tag">&lt;/<span class="title">int</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="title">str</span> <span class="attribute">name</span>=<span class="value">"df"</span>&gt;</span>text<span class="tag">&lt;/<span class="title">str</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="title">lst</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">requestHandler</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">requestHandler</span> <span class="attribute">name</span>=<span class="value">"/query"</span> <span class="attribute">class</span>=<span class="value">"solr.SearchHandler"</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="title">lst</span> <span class="attribute">name</span>=<span class="value">"defaults"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="title">str</span> <span class="attribute">name</span>=<span class="value">"echoParams"</span>&gt;</span>explicit<span class="tag">&lt;/<span class="title">str</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="title">str</span> <span class="attribute">name</span>=<span class="value">"wt"</span>&gt;</span>json<span class="tag">&lt;/<span class="title">str</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="title">str</span> <span class="attribute">name</span>=<span class="value">"indent"</span>&gt;</span>true<span class="tag">&lt;/<span class="title">str</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="title">str</span> <span class="attribute">name</span>=<span class="value">"df"</span>&gt;</span>text<span class="tag">&lt;/<span class="title">str</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="title">lst</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">requestHandler</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">admin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">defaultQuery</span>&gt;</span>*:*<span class="tag">&lt;/<span class="title">defaultQuery</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">admin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">config</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>为了方便，autocommit设置为1.5秒提交一次，同时opwensearcher=true保证每次提交后新数据的可见性</p>
<h2 id="2-_在管理页面建立core">2. 在管理页面建立core</h2><p>打开solr管理页面，在<code>Core Admin</code>选项里选择<code>Add Core</code>，这里会有几个属性：</p>
<ul>
<li><strong>name</strong> core的名称，和你的core文件夹名相同，这里是student</li>
<li><strong>instanceDir</strong> core文件夹相对于solrhome的位置，这里就在solrhome下，直接填student，如果位于子目录下，就填比如<code>collection1/student</code>这种形式</li>
<li><strong>dataDir</strong> core数据储存位置，这里默认</li>
<li><strong>config</strong> solrconfig位置，默认</li>
<li><strong>schema</strong> schema位置，默认</li>
</ul>
<p>如果在建立core的时候发生错误，管理页面会一直有个错误提示去不掉，你可以完全删除core文件夹，重启solr再重复建core操作，即可解决。</p>
<h1 id="二、数据导入">二、数据导入</h1><p>使用upload方法导入一批数据。打开管理页面 core-selector-&gt;student-&gt;Documents，选择json方式分别导入了以下三条数据：<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "<span class="attribute">id</span>": <span class="value"><span class="number">1</span></span>,</span><br><span class="line">  "<span class="attribute">name</span>": <span class="value"><span class="string">"James"</span></span>,</span><br><span class="line">  "<span class="attribute">birthday</span>": <span class="value"><span class="string">"1991-01-01T00:00:00Z"</span></span>,</span><br><span class="line">  "<span class="attribute">avg_score</span>": <span class="value"><span class="number">111</span></span>,</span><br><span class="line">  "<span class="attribute">hobby</span>": <span class="value">[</span><br><span class="line">    <span class="string">"篮球"</span></span><br><span class="line">  ]</span>,</span><br><span class="line">  "<span class="attribute">motto</span>": <span class="value"><span class="string">"业精于勤,荒于嬉.行成于思,毁于随"</span></span><br><span class="line"></span>&#125;</span><br><span class="line">&#123;</span><br><span class="line">  "<span class="attribute">id</span>": <span class="value"><span class="number">2</span></span>,</span><br><span class="line">  "<span class="attribute">name</span>": <span class="value"><span class="string">"小王"</span></span>,</span><br><span class="line">  "<span class="attribute">birthday</span>": <span class="value"><span class="string">"1991-01-01T00:00:00Z"</span></span>,</span><br><span class="line">  "<span class="attribute">avg_score</span>": <span class="value"><span class="number">111</span></span>,</span><br><span class="line">  "<span class="attribute">hobby</span>": <span class="value">[</span><br><span class="line">    <span class="string">"唱K"</span></span><br><span class="line">  ]</span>,</span><br><span class="line">  "<span class="attribute">motto</span>": <span class="value"><span class="string">"To be, or not to be: that is the question"</span></span><br><span class="line"></span>&#125;</span><br><span class="line">&#123;</span><br><span class="line">  "<span class="attribute">id</span>": <span class="value"><span class="number">3</span></span>,</span><br><span class="line">  "<span class="attribute">name</span>": <span class="value"><span class="string">"李明"</span></span>,</span><br><span class="line">  "<span class="attribute">birthday</span>": <span class="value"><span class="string">"1991-01-01T00:00:00Z"</span></span>,</span><br><span class="line">  "<span class="attribute">avg_score</span>": <span class="value"><span class="number">111</span></span>,</span><br><span class="line">  "<span class="attribute">hobby</span>": <span class="value">[</span><br><span class="line">    <span class="string">"篮球"</span>,</span><br><span class="line">    <span class="string">"看电影"</span>,</span><br><span class="line">    <span class="string">"夜跑"</span></span><br><span class="line">  ]</span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure></p>
<p>这样一来，索引就算是创建好了，而且我们也导入了需要搜索的数据，打开Query界面，可以在这里进行简单的查询，看看我们刚刚导入的数据如何。<br>修改”q”字段为 <code>hobby:篮球</code>，点击查询，可以看到id=1,3的doc被查询了出来，说明我们导入的数据已经被成功索引了。注意，solr还帮我们在数据上方生成了这一次索引的请求url，<a href="http://182.92.158.145:8983/solr/student/select?q=hobby%3A%E7%AF%AE%E7%90%83&amp;wt=json&amp;indent=true" target="_blank" rel="external">http://182.92.158.145:8983/solr/student/select?q=hobby%3A%E7%AF%AE%E7%90%83&amp;wt=json&amp;indent=true</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/solr/">solr</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/solr/">solr</a><a href="/tags/搜索/">搜索</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/solr/ciglxh0sx0000xcnw9oysw9r5.html" title="Solr学习第01章：安装与配置" itemprop="url">Solr学习第01章：安装与配置</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="BigCat" target="_blank" itemprop="author">BigCat</a>
		
  <p class="article-time">
    <time datetime="2015-10-28T02:01:31.000Z" itemprop="datePublished"> 发表于 2015-10-28</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="一、Solr简介">一、Solr简介</h1><p>Apache Solr官网</p>
<blockquote>
<p>Solr is highly reliable, scalable and fault tolerant, providing distributed indexing,<br>replication and load-balanced querying, automated failover and recovery, centralized configuration and more.<br>Solr powers the search and navigation features of many of the world’s largest internet sites. –Apache Solr官网<br>百度百科<br>Solr是一个高性能，采用Java5开发，基于Lucene的全文搜索服务器。同时对其进行了扩展，提供了比Lucene更为丰富的查询语言，<br>同时实现了可配置、可扩展并对查询性能进行了优化，并且提供了一个完善的功能管理界面，是一款非常优秀的全文搜索引擎。–百度百科</p>
</blockquote>
<p>总而言之，Solr是一个开源的基于java的搜索解决方案，如果你想部署自己的搜索服务，不想受制于第三方搜索服务的限制，那么选择Solr吧，它一定不会让你失望</p>
<h1 id="二、Solr的安装">二、Solr的安装</h1><h2 id="官方下载地址">官方下载地址</h2><p>下载地址 <code>http://lucene.apache.org/solr/mirrors-solr-latest-redir.html</code></p>
<h2 id="CentOS_7_下solr的安装部署">CentOS 7 下solr的安装部署</h2><p>Solr版本 <code>5.7.1</code><br>Solr在5.0版本之后取消了对于web容器的依赖，或者说，内置了Jetty容器而不是以war包的形式发布。5.0版本后的部署非常简单，达到了开箱即用的效果。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cd /opt</span><br><span class="line">wget http:<span class="comment">//mirror.bit.edu.cn/apache/lucene/solr/5.3.1/solr-5.3.1.tgz</span></span><br><span class="line">tar zxvf solr-<span class="number">5.3</span><span class="number">.1</span>.tgz -C /opt</span><br><span class="line">cd /opt/solr-<span class="number">5.3</span><span class="number">.1</span>/bin</span><br><span class="line">./solr start <span class="preprocessor">#启动</span></span><br><span class="line">./solr stop <span class="preprocessor">#停止</span></span><br><span class="line">./solr restart -p <span class="number">8983</span> <span class="preprocessor">#重启<span class="number">8983</span>端口的solr</span></span><br><span class="line">./solr start -help <span class="preprocessor">#详细帮助，可以切换端口，重设solrhome等</span></span><br></pre></td></tr></table></figure></p>
<p>启动后，会看到<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Waiting up <span class="keyword">to</span> <span class="number">30</span> seconds <span class="keyword">to</span> see Solr <span class="property">running</span> <span class="function_start"><span class="keyword">on</span></span> port <span class="number">8983</span> [/]  </span><br><span class="line">Started Solr server <span class="function_start"><span class="keyword">on</span></span> port <span class="number">8983</span> (pid=<span class="number">1248</span>). Happy searching!</span><br></pre></td></tr></table></figure></p>
<p>这时候访问 host:port/solr/（本地默认为<a href="http://localhost:8983/solr/" target="_blank" rel="external">http://localhost:8983/solr/</a> ） 如果看到solr的网页管理页面，大功告成！是不是很easy？</p>
<p>管理页面左侧有几个标签：</p>
<ul>
<li>Dashboard 可以看的solr的基本信息、配置、内存使用等</li>
<li>Logging 网页版的日志输出，如果你在使用时遇到错误，可以在这里看到详细的报错信息</li>
<li>Core Admin 管理你的Core，比如你更新了Core的配置，不用重启solr实例，在这里refresh一下就好</li>
<li>Java Properties jvm的参数信息</li>
<li>Thread Dunp 所有的线程信息</li>
<li>Core Selector 选择一个Core，查看配置，进行自定义的查询等等</li>
</ul>
<h1 id="配置solrhome">配置solrhome</h1><p>如果保持默认设置，你的<code>{solrhome}</code>位于<code>{solr安装位置}/server/solr</code>，这个目录很重要，你的索引配置，搜索配置，数据等文件都位于这个目录下，我们接下来的工作，主要就在这个目录进行。为了方便，我们现在改变solrhome的位置，其实很简单，在启动solr的时候加入参数<code>-s &lt;dir&gt;</code>即可<br>在此之前，先在<code>/opt</code>下建立<code>mysolrhome</code>文件夹，而且<code>{solrhome}</code>要求必须含有一个<code>solr.xml</code>文件，我们直接从默认目录拷贝过来<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">solr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">solrcloud</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">str</span> <span class="attribute">name</span>=<span class="value">"host"</span>&gt;</span>$&#123;host:&#125;<span class="tag">&lt;/<span class="title">str</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">int</span> <span class="attribute">name</span>=<span class="value">"hostPort"</span>&gt;</span>$&#123;jetty.port:8983&#125;<span class="tag">&lt;/<span class="title">int</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">str</span> <span class="attribute">name</span>=<span class="value">"hostContext"</span>&gt;</span>$&#123;hostContext:solr&#125;<span class="tag">&lt;/<span class="title">str</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">bool</span> <span class="attribute">name</span>=<span class="value">"genericCoreNodeNames"</span>&gt;</span>$&#123;genericCoreNodeNames:true&#125;<span class="tag">&lt;/<span class="title">bool</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">int</span> <span class="attribute">name</span>=<span class="value">"zkClientTimeout"</span>&gt;</span>$&#123;zkClientTimeout:30000&#125;<span class="tag">&lt;/<span class="title">int</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">int</span> <span class="attribute">name</span>=<span class="value">"distribUpdateSoTimeout"</span>&gt;</span>$&#123;distribUpdateSoTimeout:600000&#125;<span class="tag">&lt;/<span class="title">int</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">int</span> <span class="attribute">name</span>=<span class="value">"distribUpdateConnTimeout"</span>&gt;</span>$&#123;distribUpdateConnTimeout:60000&#125;<span class="tag">&lt;/<span class="title">int</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">solrcloud</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">shardHandlerFactory</span> <span class="attribute">name</span>=<span class="value">"shardHandlerFactory"</span></span><br><span class="line">    <span class="attribute">class</span>=<span class="value">"HttpShardHandlerFactory"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">int</span> <span class="attribute">name</span>=<span class="value">"socketTimeout"</span>&gt;</span>$&#123;socketTimeout:600000&#125;<span class="tag">&lt;/<span class="title">int</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">int</span> <span class="attribute">name</span>=<span class="value">"connTimeout"</span>&gt;</span>$&#123;connTimeout:60000&#125;<span class="tag">&lt;/<span class="title">int</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="title">shardHandlerFactory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">solr</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>然后在bin目录输入<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./solr <span class="operator"><span class="keyword">stop</span> -<span class="keyword">p</span> <span class="number">8983</span> #停止时要用-<span class="keyword">p</span>指明停止的是哪个端口的solr</span><br><span class="line">./solr <span class="keyword">start</span> -s /opt/mysolrhome</span></span><br></pre></td></tr></table></figure></p>
<p>打开管理页面，看到运行信息中<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Dsolr<span class="class">.solr</span><span class="class">.home</span>=/opt/mysolrhome</span><br></pre></td></tr></table></figure></p>
<p>就说明成功了</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/solr/">solr</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/solr/">solr</a><a href="/tags/搜索/">搜索</a>
  </div>

</div>




<div class="comments-count">
	
</div>

</footer>


    </article>







</div>
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  


  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/solr/" title="solr">solr<sup>4</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/solr/" title="solr">solr<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/搜索/" title="搜索">搜索<sup>4</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=null&verifier=b3593ceb&dpc=1"></iframe>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/2176287895" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2015 
		
		<a href="/about" target="_blank" title="BigCat">BigCat</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>










<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fe6d1f421bbc9962127a50488f9ed37d1' type='text/javascript'%3E%3C/script%3E"));
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
